
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../changelog/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>API documentation - magic-di</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="magic-di" class="md-header__button md-logo" aria-label="magic-di" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            magic-di
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API documentation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/woltapp/magic-di" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="magic-di" class="md-nav__button md-logo" aria-label="magic-di" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    magic-di
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/woltapp/magic-di" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API documentation
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API documentation
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#magic_di" class="md-nav__link">
    <span class="md-ellipsis">
      magic_di
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.Connectable" class="md-nav__link">
    <span class="md-ellipsis">
      Connectable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.ConnectableProtocol" class="md-nav__link">
    <span class="md-ellipsis">
      ConnectableProtocol
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector" class="md-nav__link">
    <span class="md-ellipsis">
      DependencyInjector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DependencyInjector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.__hash__" class="md-nav__link">
    <span class="md-ellipsis">
      __hash__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.bind" class="md-nav__link">
    <span class="md-ellipsis">
      bind
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.disconnect" class="md-nav__link">
    <span class="md-ellipsis">
      disconnect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.get_dependencies_by_interface" class="md-nav__link">
    <span class="md-ellipsis">
      get_dependencies_by_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.inject" class="md-nav__link">
    <span class="md-ellipsis">
      inject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.lazy_inject" class="md-nav__link">
    <span class="md-ellipsis">
      lazy_inject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.override" class="md-nav__link">
    <span class="md-ellipsis">
      override
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.celery" class="md-nav__link">
    <span class="md-ellipsis">
      celery
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.fastapi" class="md-nav__link">
    <span class="md-ellipsis">
      fastapi
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fastapi">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magic_di.fastapi.inject_app" class="md-nav__link">
    <span class="md-ellipsis">
      inject_app
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.healthcheck" class="md-nav__link">
    <span class="md-ellipsis">
      healthcheck
    </span>
  </a>
  
    <nav class="md-nav" aria-label="healthcheck">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magic_di.healthcheck.DependenciesHealthcheck" class="md-nav__link">
    <span class="md-ellipsis">
      DependenciesHealthcheck
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DependenciesHealthcheck">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magic_di.healthcheck.DependenciesHealthcheck.ping" class="md-nav__link">
    <span class="md-ellipsis">
      ping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.healthcheck.DependenciesHealthcheck.ping_dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      ping_dependencies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.testing" class="md-nav__link">
    <span class="md-ellipsis">
      testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magic_di.testing.InjectableMock" class="md-nav__link">
    <span class="md-ellipsis">
      InjectableMock
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magic_di.utils.inject_and_run" class="md-nav__link">
    <span class="md-ellipsis">
      inject_and_run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#magic_di" class="md-nav__link">
    <span class="md-ellipsis">
      magic_di
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.Connectable" class="md-nav__link">
    <span class="md-ellipsis">
      Connectable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.ConnectableProtocol" class="md-nav__link">
    <span class="md-ellipsis">
      ConnectableProtocol
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector" class="md-nav__link">
    <span class="md-ellipsis">
      DependencyInjector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DependencyInjector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.__hash__" class="md-nav__link">
    <span class="md-ellipsis">
      __hash__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.bind" class="md-nav__link">
    <span class="md-ellipsis">
      bind
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.disconnect" class="md-nav__link">
    <span class="md-ellipsis">
      disconnect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.get_dependencies_by_interface" class="md-nav__link">
    <span class="md-ellipsis">
      get_dependencies_by_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.inject" class="md-nav__link">
    <span class="md-ellipsis">
      inject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.lazy_inject" class="md-nav__link">
    <span class="md-ellipsis">
      lazy_inject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.DependencyInjector.override" class="md-nav__link">
    <span class="md-ellipsis">
      override
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.celery" class="md-nav__link">
    <span class="md-ellipsis">
      celery
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.fastapi" class="md-nav__link">
    <span class="md-ellipsis">
      fastapi
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fastapi">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magic_di.fastapi.inject_app" class="md-nav__link">
    <span class="md-ellipsis">
      inject_app
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.healthcheck" class="md-nav__link">
    <span class="md-ellipsis">
      healthcheck
    </span>
  </a>
  
    <nav class="md-nav" aria-label="healthcheck">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magic_di.healthcheck.DependenciesHealthcheck" class="md-nav__link">
    <span class="md-ellipsis">
      DependenciesHealthcheck
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DependenciesHealthcheck">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magic_di.healthcheck.DependenciesHealthcheck.ping" class="md-nav__link">
    <span class="md-ellipsis">
      ping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic_di.healthcheck.DependenciesHealthcheck.ping_dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      ping_dependencies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.testing" class="md-nav__link">
    <span class="md-ellipsis">
      testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magic_di.testing.InjectableMock" class="md-nav__link">
    <span class="md-ellipsis">
      InjectableMock
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#magic_di.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magic_di.utils.inject_and_run" class="md-nav__link">
    <span class="md-ellipsis">
      inject_and_run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="api-documentation">API documentation</h1>


<div class="doc doc-object doc-module">



<a id="magic_di"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="magic_di.Connectable" class="doc doc-heading">
            <code>Connectable</code>


</h2>


    <div class="doc doc-contents ">


      <p>You can inherit from this class to make the dependency visible for DI
without adding these empty methods.</p>

              <details class="quote">
                <summary>Source code in <code>src/magic_di/_connectable.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Connectable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    You can inherit from this class to make the dependency visible for DI</span>
<span class="sd">    without adding these empty methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__connect__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__disconnect__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="magic_di.ConnectableProtocol" class="doc doc-heading">
            <code>ConnectableProtocol</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>


      <p>Interface for injectable clients.
Adding these methods to your class will allow it to be dependency injectable.
The dependency injector uses duck typing to check that the class
implements the interface.
This means that you do not need to inherit from this protocol.</p>

              <details class="quote">
                <summary>Source code in <code>src/magic_di/_connectable.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@runtime_checkable</span>
<span class="k">class</span> <span class="nc">ConnectableProtocol</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interface for injectable clients.</span>
<span class="sd">    Adding these methods to your class will allow it to be dependency injectable.</span>
<span class="sd">    The dependency injector uses duck typing to check that the class</span>
<span class="sd">    implements the interface.</span>
<span class="sd">    This means that you do not need to inherit from this protocol.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__connect__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__disconnect__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="magic_di.DependencyInjector" class="doc doc-heading">
            <code>DependencyInjector</code>


</h2>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>src/magic_di/_injector.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DependencyInjector</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bindings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">type</span><span class="p">,</span> <span class="nb">type</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logger</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span> <span class="o">=</span> <span class="n">bindings</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logger</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span> <span class="o">=</span> <span class="n">SingletonDependencyContainer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_postponed</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">inject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inject dependencies into a class/function.</span>
<span class="sd">        This method is idempotent, always returns the same instance</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (Callable[..., T]): The class/function to inject dependencies into.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Callable[..., T]: Partial for class/function with dependencies injected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unwrap_type_hint</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>

        <span class="k">if</span> <span class="n">dep</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">dep</span>

        <span class="n">signature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="n">clients</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">signature</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">clients</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">dep</span><span class="p">)()</span>

        <span class="k">if</span> <span class="n">signature</span><span class="o">.</span><span class="n">injector_arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">clients</span><span class="p">[</span><span class="n">signature</span><span class="o">.</span><span class="n">injector_arg</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clients</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InjectionError</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>

    <span class="k">def</span> <span class="nf">inspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">AnyObject</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Signature</span><span class="p">[</span><span class="n">AnyObject</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">hints</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">get_type_hints</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">hints_with_extras</span> <span class="o">=</span> <span class="n">get_type_hints</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">include_extras</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">hints</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Signature</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">is_injectable</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">is_connectable</span><span class="p">(</span><span class="n">obj</span><span class="p">)))</span>

            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="n">hints</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">hints</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;return&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">signature</span> <span class="o">=</span> <span class="n">Signature</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">is_injectable</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">is_connectable</span><span class="p">(</span><span class="n">obj</span><span class="p">)))</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">hint_</span> <span class="ow">in</span> <span class="n">hints</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">hint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unwrap_type_hint</span><span class="p">(</span><span class="n">hint_</span><span class="p">)</span>
                <span class="n">hint_with_extra</span> <span class="o">=</span> <span class="n">hints_with_extras</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">is_injector</span><span class="p">(</span><span class="n">hint</span><span class="p">):</span>
                    <span class="n">signature</span><span class="o">.</span><span class="n">injector_arg</span> <span class="o">=</span> <span class="n">name</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_connectable</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_forcefully_marked_as_injectable</span><span class="p">(</span>
                    <span class="n">hint_with_extra</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="n">signature</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">hint</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">signature</span><span class="o">.</span><span class="n">deps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">hint</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InspectionError</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>

        <span class="k">return</span> <span class="n">signature</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect all injected dependencies</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># unpack to create copy of list</span>
        <span class="k">for</span> <span class="n">postponed</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_postponed</span><span class="p">]:</span>
            <span class="c1"># First, we need to create instances of postponed injection</span>
            <span class="c1"># in order to connect them.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">postponed</span><span class="p">)</span>

        <span class="k">for</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span><span class="o">.</span><span class="n">iter_instances</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">connectable_instance</span> <span class="o">:=</span> <span class="n">is_connectable</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Connecting </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">connectable_instance</span><span class="o">.</span><span class="n">__connect__</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disconnect all injected dependencies</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span><span class="o">.</span><span class="n">iter_instances</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">connectable_instance</span> <span class="o">:=</span> <span class="n">is_connectable</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">connectable_instance</span><span class="o">.</span><span class="n">__disconnect__</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Failed to disconnect </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_dependencies_by_interface</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">interface</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">AnyObject</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">AnyObject</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all injected dependencies that implement a particular interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span><span class="o">.</span><span class="n">iter_instances</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">safe_is_instance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">interface</span><span class="p">):</span>  <span class="c1"># type: ignore[arg-type]</span>
                <span class="k">yield</span> <span class="n">instance</span>  <span class="c1"># type: ignore[misc]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DependencyInjector</span><span class="p">:</span>  <span class="c1"># noqa: PYI034</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">iter_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">object</span><span class="p">]:</span>
        <span class="n">instance</span><span class="p">:</span> <span class="nb">object</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span><span class="o">.</span><span class="n">iter_instances</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">instance</span>

    <span class="k">def</span> <span class="nf">lazy_inject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lazily inject dependencies into a class or function.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (Callable[..., T]): The class or function to inject dependencies into.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Callable[..., T]: A function that, when called,</span>
<span class="sd">            will inject the dependencies and</span>
<span class="sd">            return the injected class instance or function.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_postponed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
            <span class="c1"># incompatible type &quot;Callable[..., T]&quot;; expected &quot;Callable[..., T]&quot;</span>

        <span class="n">injected</span><span class="p">:</span> <span class="n">T</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">inject</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
            <span class="k">nonlocal</span> <span class="n">injected</span>

            <span class="k">if</span> <span class="n">injected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">injected</span>

            <span class="n">injected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">obj</span><span class="p">)()</span>
            <span class="k">return</span> <span class="n">injected</span>

        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">inject</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">type</span><span class="p">,</span> <span class="nb">type</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bind new bindings to the injector.</span>

<span class="sd">        This method is used to add new bindings to the injector.</span>
<span class="sd">        Bindings are a dictionary where the keys are the</span>
<span class="sd">        classes used in dependencies type hints,</span>
<span class="sd">        and the values are the classes that should replace them.</span>

<span class="sd">        For example, if you have a class `Foo` that depends on an interface `Bar`,</span>
<span class="sd">        and you have a class `BarImpl` that implements `Bar`,</span>
<span class="sd">        you would add a binding like this: `injector.bind({Bar: BarImpl})`.</span>
<span class="sd">        Then, whenever `Foo` is injected,</span>
<span class="sd">        it will receive an instance of `BarImpl` instead of `Bar`.</span>

<span class="sd">        If a binding for a particular class or type already exists,</span>
<span class="sd">        this method will update that binding with the new value</span>

<span class="sd">        Args:</span>
<span class="sd">            bindings (dict[type, type]): The bindings to add.</span>
<span class="sd">            This should be a dictionary where the keys are</span>
<span class="sd">            classes and the values are the classes that should replace them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span> <span class="o">|</span> <span class="n">bindings</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">override</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">type</span><span class="p">,</span> <span class="nb">type</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Temporarily override the bindings and dependencies of the injector.</span>

<span class="sd">        Args:</span>
<span class="sd">            bindings (dict): The bindings to use for the override.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="n">actual_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span>
            <span class="n">actual_bindings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span> <span class="o">=</span> <span class="n">SingletonDependencyContainer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span> <span class="o">|</span> <span class="n">bindings</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span> <span class="o">=</span> <span class="n">actual_deps</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span> <span class="o">=</span> <span class="n">actual_bindings</span>

    <span class="k">def</span> <span class="nf">_unwrap_type_hint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">AnyObject</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="n">AnyObject</span><span class="p">]:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">get_cls_from_optional</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Injector is always unique&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="magic_di.DependencyInjector.__hash__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__hash__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Injector is always unique</p>

            <details class="quote">
              <summary>Source code in <code>src/magic_di/_injector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Injector is always unique&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="magic_di.DependencyInjector.bind" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bind</span><span class="p">(</span><span class="n">bindings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">type</span><span class="p">,</span> <span class="nb">type</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Bind new bindings to the injector.</p>
<p>This method is used to add new bindings to the injector.
Bindings are a dictionary where the keys are the
classes used in dependencies type hints,
and the values are the classes that should replace them.</p>
<p>For example, if you have a class <code>Foo</code> that depends on an interface <code>Bar</code>,
and you have a class <code>BarImpl</code> that implements <code>Bar</code>,
you would add a binding like this: <code>injector.bind({Bar: BarImpl})</code>.
Then, whenever <code>Foo</code> is injected,
it will receive an instance of <code>BarImpl</code> instead of <code>Bar</code>.</p>
<p>If a binding for a particular class or type already exists,
this method will update that binding with the new value</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>bindings</code></td>
            <td>
                  <code>dict[type, type]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bindings to add.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/magic_di/_injector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">type</span><span class="p">,</span> <span class="nb">type</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bind new bindings to the injector.</span>

<span class="sd">    This method is used to add new bindings to the injector.</span>
<span class="sd">    Bindings are a dictionary where the keys are the</span>
<span class="sd">    classes used in dependencies type hints,</span>
<span class="sd">    and the values are the classes that should replace them.</span>

<span class="sd">    For example, if you have a class `Foo` that depends on an interface `Bar`,</span>
<span class="sd">    and you have a class `BarImpl` that implements `Bar`,</span>
<span class="sd">    you would add a binding like this: `injector.bind({Bar: BarImpl})`.</span>
<span class="sd">    Then, whenever `Foo` is injected,</span>
<span class="sd">    it will receive an instance of `BarImpl` instead of `Bar`.</span>

<span class="sd">    If a binding for a particular class or type already exists,</span>
<span class="sd">    this method will update that binding with the new value</span>

<span class="sd">    Args:</span>
<span class="sd">        bindings (dict[type, type]): The bindings to add.</span>
<span class="sd">        This should be a dictionary where the keys are</span>
<span class="sd">        classes and the values are the classes that should replace them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span> <span class="o">|</span> <span class="n">bindings</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="magic_di.DependencyInjector.connect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">connect</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Connect all injected dependencies</p>

            <details class="quote">
              <summary>Source code in <code>src/magic_di/_injector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Connect all injected dependencies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># unpack to create copy of list</span>
    <span class="k">for</span> <span class="n">postponed</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_postponed</span><span class="p">]:</span>
        <span class="c1"># First, we need to create instances of postponed injection</span>
        <span class="c1"># in order to connect them.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">postponed</span><span class="p">)</span>

    <span class="k">for</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span><span class="o">.</span><span class="n">iter_instances</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">connectable_instance</span> <span class="o">:=</span> <span class="n">is_connectable</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Connecting </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">connectable_instance</span><span class="o">.</span><span class="n">__connect__</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="magic_di.DependencyInjector.disconnect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">disconnect</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Disconnect all injected dependencies</p>

            <details class="quote">
              <summary>Source code in <code>src/magic_di/_injector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Disconnect all injected dependencies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span><span class="o">.</span><span class="n">iter_instances</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">connectable_instance</span> <span class="o">:=</span> <span class="n">is_connectable</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">connectable_instance</span><span class="o">.</span><span class="n">__disconnect__</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Failed to disconnect </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="magic_di.DependencyInjector.get_dependencies_by_interface" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dependencies_by_interface</span><span class="p">(</span><span class="n">interface</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">AnyObject</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">AnyObject</span><span class="p">]</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Get all injected dependencies that implement a particular interface.</p>

            <details class="quote">
              <summary>Source code in <code>src/magic_di/_injector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_dependencies_by_interface</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">interface</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">AnyObject</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">AnyObject</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all injected dependencies that implement a particular interface.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span><span class="o">.</span><span class="n">iter_instances</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">safe_is_instance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">interface</span><span class="p">):</span>  <span class="c1"># type: ignore[arg-type]</span>
            <span class="k">yield</span> <span class="n">instance</span>  <span class="c1"># type: ignore[misc]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="magic_di.DependencyInjector.inject" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inject</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Inject dependencies into a class/function.
This method is idempotent, always returns the same instance</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>obj</code></td>
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[..., <span title="magic_di._injector.T">T</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The class/function to inject dependencies into.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[..., <span title="magic_di._injector.T">T</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callable[..., T]: Partial for class/function with dependencies injected.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/magic_di/_injector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">inject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inject dependencies into a class/function.</span>
<span class="sd">    This method is idempotent, always returns the same instance</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (Callable[..., T]): The class/function to inject dependencies into.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Callable[..., T]: Partial for class/function with dependencies injected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unwrap_type_hint</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>

    <span class="k">if</span> <span class="n">dep</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dep</span>

    <span class="n">signature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="n">clients</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">signature</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">clients</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">dep</span><span class="p">)()</span>

    <span class="k">if</span> <span class="n">signature</span><span class="o">.</span><span class="n">injector_arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">clients</span><span class="p">[</span><span class="n">signature</span><span class="o">.</span><span class="n">injector_arg</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clients</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InjectionError</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="magic_di.DependencyInjector.lazy_inject" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lazy_inject</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Lazily inject dependencies into a class or function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>obj</code></td>
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[..., <span title="magic_di._injector.T">T</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The class or function to inject dependencies into.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[..., <span title="magic_di._injector.T">T</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callable[..., T]: A function that, when called,</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[..., <span title="magic_di._injector.T">T</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>will inject the dependencies and</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[..., <span title="magic_di._injector.T">T</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>return the injected class instance or function.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/magic_di/_injector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">lazy_inject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lazily inject dependencies into a class or function.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (Callable[..., T]): The class or function to inject dependencies into.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Callable[..., T]: A function that, when called,</span>
<span class="sd">        will inject the dependencies and</span>
<span class="sd">        return the injected class instance or function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_postponed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
        <span class="c1"># incompatible type &quot;Callable[..., T]&quot;; expected &quot;Callable[..., T]&quot;</span>

    <span class="n">injected</span><span class="p">:</span> <span class="n">T</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">inject</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">nonlocal</span> <span class="n">injected</span>

        <span class="k">if</span> <span class="n">injected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">injected</span>

        <span class="n">injected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">obj</span><span class="p">)()</span>
        <span class="k">return</span> <span class="n">injected</span>

    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">inject</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="magic_di.DependencyInjector.override" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">override</span><span class="p">(</span><span class="n">bindings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">type</span><span class="p">,</span> <span class="nb">type</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Temporarily override the bindings and dependencies of the injector.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>bindings</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bindings to use for the override.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/magic_di/_injector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">override</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">type</span><span class="p">,</span> <span class="nb">type</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Temporarily override the bindings and dependencies of the injector.</span>

<span class="sd">    Args:</span>
<span class="sd">        bindings (dict): The bindings to use for the override.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
        <span class="n">actual_deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span>
        <span class="n">actual_bindings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span> <span class="o">=</span> <span class="n">SingletonDependencyContainer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span> <span class="o">|</span> <span class="n">bindings</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deps</span> <span class="o">=</span> <span class="n">actual_deps</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span> <span class="o">=</span> <span class="n">actual_bindings</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>



<div class="doc doc-object doc-module">



<h2 id="magic_di.celery" class="doc doc-heading">
            <code>celery</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="magic_di.fastapi" class="doc doc-heading">
            <code>fastapi</code>


</h2>

    <div class="doc doc-contents ">

      <p>Package containing tools for integrating Dependency Injector with FastAPI framework.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="magic_di.fastapi.inject_app" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inject_app</span><span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">injector</span><span class="p">:</span> <span class="n">DependencyInjector</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_deprecated_events</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FastAPI</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Inject dependencies into a FastAPI application using the provided injector.</p>
<p>This function sets up the FastAPI application to connect and disconnect the injector
at startup and shutdown, respectively.</p>
<p>This ensures that all dependencies are properly
connected when the application starts, and properly disconnected when the application
shuts down.</p>
<p>If no injector is provided, a default injector is used.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>app</code></td>
            <td>
                  <code><span title="fastapi.FastAPI">FastAPI</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The FastAPI application</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>injector</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="magic_di._injector.DependencyInjector" href="#magic_di.DependencyInjector">DependencyInjector</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The injector to use for dependency injection.
                                     If not provided, a default injector will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>use_deprecated_events</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicate whether the app should be injected
                                    with starlette events (which are deprecated)
                                    or use app lifespans.
                                    Important: Use this flag only
                                    if you still use app events,
                                    because if lifespans are defined,
                                    events will be ignored by Starlette.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>FastAPI</code></td>            <td>
                  <code><span title="fastapi.FastAPI">FastAPI</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The FastAPI application with dependencies injected.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/magic_di/fastapi/_app.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">inject_app</span><span class="p">(</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">FastAPI</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">injector</span><span class="p">:</span> <span class="n">DependencyInjector</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_deprecated_events</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FastAPI</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inject dependencies into a FastAPI application using the provided injector.</span>

<span class="sd">    This function sets up the FastAPI application to connect and disconnect the injector</span>
<span class="sd">    at startup and shutdown, respectively.</span>

<span class="sd">    This ensures that all dependencies are properly</span>
<span class="sd">    connected when the application starts, and properly disconnected when the application</span>
<span class="sd">    shuts down.</span>

<span class="sd">    If no injector is provided, a default injector is used.</span>

<span class="sd">    Args:</span>
<span class="sd">        app (FastAPI): The FastAPI application</span>

<span class="sd">        injector (DependencyInjector, optional): The injector to use for dependency injection.</span>
<span class="sd">                                                 If not provided, a default injector will be used.</span>

<span class="sd">        use_deprecated_events (bool, optional): Indicate whether the app should be injected</span>
<span class="sd">                                                with starlette events (which are deprecated)</span>
<span class="sd">                                                or use app lifespans.</span>
<span class="sd">                                                Important: Use this flag only</span>
<span class="sd">                                                if you still use app events,</span>
<span class="sd">                                                because if lifespans are defined,</span>
<span class="sd">                                                events will be ignored by Starlette.</span>

<span class="sd">    Returns:</span>
<span class="sd">        FastAPI: The FastAPI application with dependencies injected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">injector</span> <span class="o">=</span> <span class="n">injector</span> <span class="ow">or</span> <span class="n">DependencyInjector</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">collect_deps</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_collect_dependencies</span><span class="p">(</span><span class="n">injector</span><span class="p">,</span> <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="p">)</span>

    <span class="n">app</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dependency_injector</span> <span class="o">=</span> <span class="n">injector</span>

    <span class="k">if</span> <span class="n">use_deprecated_events</span><span class="p">:</span>
        <span class="n">_inject_app_with_events</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">collect_deps_fn</span><span class="o">=</span><span class="n">collect_deps</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_inject_app_with_lifespan</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">collect_deps_fn</span><span class="o">=</span><span class="n">collect_deps</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">app</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="magic_di.healthcheck" class="doc doc-heading">
            <code>healthcheck</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="magic_di.healthcheck.DependenciesHealthcheck" class="doc doc-heading">
            <code>DependenciesHealthcheck</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="magic_di.Connectable" href="#magic_di.Connectable">Connectable</a></code></p>


      <p>Injectable Healthcheck component that pings all injected dependencies
that implement the PingableProtocol</p>
<p>Example usage:</p>
<pre><code class="language-py">from app.components.services.health import DependenciesHealthcheck

async def main(redis: Redis, deps_healthcheck: DependenciesHealthcheck) -&gt; None:
    await deps_healthcheck.ping_dependencies()  # redis will be pinged if it has method __ping__

inject_and_run(main)
</code></pre>

              <details class="quote">
                <summary>Source code in <code>src/magic_di/healthcheck.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DependenciesHealthcheck</span><span class="p">(</span><span class="n">Connectable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Injectable Healthcheck component that pings all injected dependencies</span>
<span class="sd">    that implement the PingableProtocol</span>

<span class="sd">    Example usage:</span>

<span class="sd">    ``` py</span>
<span class="sd">    from app.components.services.health import DependenciesHealthcheck</span>

<span class="sd">    async def main(redis: Redis, deps_healthcheck: DependenciesHealthcheck) -&gt; None:</span>
<span class="sd">        await deps_healthcheck.ping_dependencies()  # redis will be pinged if it has method __ping__</span>

<span class="sd">    inject_and_run(main)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">injector</span><span class="p">:</span> <span class="n">DependencyInjector</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">ping_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_concurrency</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ping all dependencies that implement the PingableProtocol</span>

<span class="sd">        :param max_concurrency: Maximum number of concurrent pings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tasks</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">Future</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dependency</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">injector</span><span class="o">.</span><span class="n">get_dependencies_by_interface</span><span class="p">(</span><span class="n">PingableProtocol</span><span class="p">):</span>
                <span class="n">future</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ping</span><span class="p">(</span><span class="n">dependency</span><span class="p">))</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">max_concurrency</span><span class="p">:</span>
                    <span class="n">tasks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">tasks</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
                <span class="n">tasks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
                <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">tasks</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">):</span>
                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dependency</span><span class="p">:</span> <span class="n">PingableProtocol</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ping a single dependency</span>

<span class="sd">        :param dependency: Dependency to ping</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dependency_name</span> <span class="o">=</span> <span class="n">dependency</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">injector</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Pinging dependency </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">dependency_name</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">dependency</span><span class="o">.</span><span class="n">__ping__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">injector</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Dependency </span><span class="si">%s</span><span class="s2"> is healthy&quot;</span><span class="p">,</span> <span class="n">dependency_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="magic_di.healthcheck.DependenciesHealthcheck.ping" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ping</span><span class="p">(</span><span class="n">dependency</span><span class="p">:</span> <span class="n">PingableProtocol</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Ping a single dependency</p>
<p>:param dependency: Dependency to ping</p>

            <details class="quote">
              <summary>Source code in <code>src/magic_di/healthcheck.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dependency</span><span class="p">:</span> <span class="n">PingableProtocol</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ping a single dependency</span>

<span class="sd">    :param dependency: Dependency to ping</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dependency_name</span> <span class="o">=</span> <span class="n">dependency</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">injector</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Pinging dependency </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">dependency_name</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">dependency</span><span class="o">.</span><span class="n">__ping__</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">injector</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Dependency </span><span class="si">%s</span><span class="s2"> is healthy&quot;</span><span class="p">,</span> <span class="n">dependency_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="magic_di.healthcheck.DependenciesHealthcheck.ping_dependencies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ping_dependencies</span><span class="p">(</span><span class="n">max_concurrency</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Ping all dependencies that implement the PingableProtocol</p>
<p>:param max_concurrency: Maximum number of concurrent pings</p>

            <details class="quote">
              <summary>Source code in <code>src/magic_di/healthcheck.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">ping_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_concurrency</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ping all dependencies that implement the PingableProtocol</span>

<span class="sd">    :param max_concurrency: Maximum number of concurrent pings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tasks</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">Future</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dependency</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">injector</span><span class="o">.</span><span class="n">get_dependencies_by_interface</span><span class="p">(</span><span class="n">PingableProtocol</span><span class="p">):</span>
            <span class="n">future</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ping</span><span class="p">(</span><span class="n">dependency</span><span class="p">))</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">max_concurrency</span><span class="p">:</span>
                <span class="n">tasks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">):</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="magic_di.testing" class="doc doc-heading">
            <code>testing</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="magic_di.testing.InjectableMock" class="doc doc-heading">
            <code>InjectableMock</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="unittest.mock.AsyncMock">AsyncMock</span></code></p>


      <p>You can use this mock to override dependencies in tests
and use AsyncMock instead of a real class instance</p>
<p>Example:</p>
<pre><code class="language-py">@pytest.fixture()
def client():
  injector = DependencyInjector()

  with injector.override({Service: InjectableMock().mock_cls}):
    with TestClient(app) as client:
        yield client

def test_http_handler(client):
  resp = client.post('/hello-world')

  assert resp.status_code == 200
</code></pre>

              <details class="quote">
                <summary>Source code in <code>src/magic_di/testing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">InjectableMock</span><span class="p">(</span><span class="n">AsyncMock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    You can use this mock to override dependencies in tests</span>
<span class="sd">    and use AsyncMock instead of a real class instance</span>

<span class="sd">    Example:</span>
<span class="sd">    ``` py</span>
<span class="sd">    @pytest.fixture()</span>
<span class="sd">    def client():</span>
<span class="sd">      injector = DependencyInjector()</span>

<span class="sd">      with injector.override({Service: InjectableMock().mock_cls}):</span>
<span class="sd">        with TestClient(app) as client:</span>
<span class="sd">            yield client</span>

<span class="sd">    def test_http_handler(client):</span>
<span class="sd">      resp = client.post(&#39;/hello-world&#39;)</span>

<span class="sd">      assert resp.status_code == 200</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mock_cls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="n">ConnectableProtocol</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">get_injectable_mock_cls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__connect__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__disconnect__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InjectableMock</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="magic_di.utils" class="doc doc-heading">
            <code>utils</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="magic_di.utils.inject_and_run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inject_and_run</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">],</span> <span class="n">injector</span><span class="p">:</span> <span class="n">DependencyInjector</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>This function takes a callable, injects dependencies into it using the provided injector,
and then runs the function. If the function is a coroutine, it will be awaited.</p>
<p>The function itself is not asynchronous, but it uses asyncio.run
to run the internal coroutine, so it is suitable for use in synchronous code.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fn</code></td>
            <td>
                  <code><span title="collections.abc.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The function into which dependencies will be injected. This can be
           a regular function or a coroutine function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>injector</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="magic_di.DependencyInjector" href="#magic_di.DependencyInjector">DependencyInjector</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The injector to use for dependency injection.
                                     If not provided, a default injector will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Any</code></td>            <td>
                  <code><span title="magic_di.utils.T">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The return value of the function <code>fn</code> after dependency injection and execution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/magic_di/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">inject_and_run</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">],</span>
    <span class="n">injector</span><span class="p">:</span> <span class="n">DependencyInjector</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function takes a callable, injects dependencies into it using the provided injector,</span>
<span class="sd">    and then runs the function. If the function is a coroutine, it will be awaited.</span>

<span class="sd">    The function itself is not asynchronous, but it uses asyncio.run</span>
<span class="sd">    to run the internal coroutine, so it is suitable for use in synchronous code.</span>

<span class="sd">    Args:</span>
<span class="sd">        fn (Callable): The function into which dependencies will be injected. This can be</span>
<span class="sd">                       a regular function or a coroutine function.</span>
<span class="sd">        injector (DependencyInjector, optional): The injector to use for dependency injection.</span>
<span class="sd">                                                 If not provided, a default injector will be used.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any: The return value of the function `fn` after dependency injection and execution.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Any exceptions raised by the function `fn` or the injector will be propagated up to</span>
<span class="sd">        the caller of this function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">injector</span> <span class="o">=</span> <span class="n">injector</span> <span class="ow">or</span> <span class="n">DependencyInjector</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="n">injected</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">injector</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">injected</span><span class="p">()</span>  <span class="c1"># type: ignore[misc,no-any-return]</span>

            <span class="k">return</span> <span class="n">injected</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>